# TODO.md Whitespace Conflict Analysis

## Issue Summary
The `todo.ai` tamper detection system is frequently triggered during commits due to conflicts with pre-commit hooks. Specifically, the `trailing-whitespace` hook modifies `TODO.md` to remove trailing spaces that are generated by `todo.ai`.

## Impact
1. **Tamper Detection False Positives:** When `todo.ai` writes `TODO.md`, it includes trailing whitespaces. The pre-commit hook removes them, changing the file checksum.
2. **Workflow Interruption:** The user (or agent) must manually accept the tamper error to proceed with the commit, breaking the "seamless" flow.
3. **State Inconsistency:** The internal state checksum expects the version with whitespace, while the committed version has it stripped.

## Root Cause Analysis
- **Generator Output:** The `todo.ai` logic (likely in `FileOps` or template rendering) produces lines with trailing whitespace.
- **Linter Strictness:** The `trailing-whitespace` pre-commit hook is configured to strip these spaces globally.
- **Managed File Conflict:** `.todo.ai/state/` files and `TODO.md` are being linted, but they are machine-generated and managed by `todo.ai`.

## Proposed Solutions

### 1. Fix Generator Output (Primary)
Ensure `todo.ai` writes "clean" markdown that complies with standard linting rules.
- **Action:** Audit `todo_ai/core/file_ops.py` and any template rendering logic.
- **Requirement:** Strip trailing whitespace from all lines before writing to disk.

### 2. Adjust Linter Configuration
Prevent linters from checking internal state files that shouldn't be manually edited anyway.
- **Action:** Update `.pre-commit-config.yaml` to exclude `.todo.ai/` directory.
- **Rationale:** The state directory contains checksums and logs that might have specific formatting needs or are simply not code that needs linting.

### 3. Verify Tamper Logic
Ensure the tamper detection hash calculation normalizes whitespace if appropriate (though fixing the output is cleaner).
